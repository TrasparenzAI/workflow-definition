{
  "createTime": 1706170915910,
  "updateTime": 1706173716218,
  "name": "crawler_amministrazione_trasparente",
  "description": "Crawler Amministrazione Trasparente",
  "version": 1,
  "tasks": [
    {
      "name": "Set Initial Last Page",
      "taskReferenceName": "set_initial_last_page_ref",
      "inputParameters": {
        "last_page": false
      },
      "type": "SET_VARIABLE"
    },
    {
      "name": "Parent Workflow ID",
      "taskReferenceName": "parent_workflow_id_ref",
      "inputParameters": {
        "expression": "(function(){if ($.s && $.s.length() > 0) { return $.s; } else { return  $.l; }})();",
        "evaluatorType": "javascript",
        "s": "${workflow.input.parent_workflow_id}",
        "l": "${workflow.workflowId}"
      },
      "type": "INLINE"
    },
    {
      "name": "page_divide_size",
      "taskReferenceName": "page_divide_size_ref",
      "inputParameters": {
        "expression": "(function(){ return Math.floor($.s / 20) })();",
        "evaluatorType": "javascript",
        "s": "${workflow.input.page_size}"
      },
      "type": "INLINE"
    },
    {
      "name": "pagination_task",
      "taskReferenceName": "pagination_task_ref",
      "inputParameters": {
        "last_page": "${workflow.variables.last_page}"
      },
      "type": "DO_WHILE",
      "loopCondition": "if ($.last_page) { false; } else { true; }",
      "loopOver": [
        {
          "name": "iteration_task",
          "taskReferenceName": "iteration_task_ref",
          "inputParameters": {
            "expression": "(function(){ return ($.i - 1 | 0);})();",
            "evaluatorType": "javascript",
            "i": "${pagination_task_ref.output.iteration}"
          },
          "type": "INLINE"
        },
        {
          "name": "companies_task",
          "taskReferenceName": "companies_task_ref",
          "inputParameters": {
            "http_request": {
              "uri": "https://dica33.ba.cnr.it/public-sites-service/v1/companies?size=${workflow.input.page_size}&idIpaFrom=${workflow.input.id_ipa_from}&codiceIpa=${workflow.input.codice_ipa}&codiceCategoria=${workflow.input.codice_categoria}&page=${iteration_task_ref.output.result}&sort=id",
              "method": "GET",
              "connectionTimeOut": 3000,
              "readTimeOut": 30000,
              "accept": "application/json",
              "contentType": "application/json"
            }
          },
          "type": "HTTP"
        },
        {
          "name": "fork",
          "taskReferenceName": "fork_ref",
          "inputParameters": {},
          "type": "FORK_JOIN",
          "decisionCases": {},
          "defaultCase": [],
          "forkTasks": [
            [
              {
                "name": "companies_chunk_0",
                "taskReferenceName": "companies_chunk_0_ref",
                "inputParameters": {
                  "companies": "${companies_task_ref.output.response.body.content}",
                  "queryExpression": ".companies |.[0:${page_divide_size_ref.output.result}]"
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_0_size",
                "taskReferenceName": "companies_chunk_0_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_0_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_0",
                "taskReferenceName": "switch_companies_chunk_0_ref",
                "inputParameters": {
                  "size": "${companies_chunk_0_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                  {
                    "name": "start_rule_workflow_chunck_0",
                    "taskReferenceName": "start_rule_workflow_chunck_0_ref",
                    "inputParameters": {
                      "companies": "${companies_chunk_0_ref.output.result}",
                      "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                      "crawler_save_object": "${workflow.input.crawler_save_object}",
                      "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                      "save_method": "PUT",
                      "rule_name": "${workflow.input.rule_name}",
                      "execute_child": "${workflow.input.execute_child}",
                      "connection_timeout": "${workflow.input.connection_timeout}",
                      "read_timeout": "${workflow.input.read_timeout}"
                    },
                    "subWorkflowParam": {
                      "name": "rule_workflow",
                      "version": 1
                    },                
                    "type": "SUB_WORKFLOW"
                  }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_1",
                "taskReferenceName": "companies_chunk_1_ref",
                "inputParameters": {
                "companies": "${companies_task_ref.output.response.body.content}",
                "queryExpression": ".companies |.[${page_divide_size_ref.output.result}:${page_divide_size_ref.output.result} * 2]"
              },
              "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_1_size",
                "taskReferenceName": "companies_chunk_1_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_1_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_1",
                "taskReferenceName": "switch_companies_chunk_1_ref",
                "inputParameters": {
                  "size": "${companies_chunk_1_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                  {
                    "name": "start_rule_workflow_chunck_1",
                    "taskReferenceName": "start_rule_workflow_chunck_1_ref",
                    "inputParameters": {
                      "companies": "${companies_chunk_1_ref.output.result}",
                      "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                      "crawler_save_object": "${workflow.input.crawler_save_object}",
                      "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                      "save_method": "PUT",
                      "rule_name": "${workflow.input.rule_name}",
                      "execute_child": "${workflow.input.execute_child}",
                      "connection_timeout": "${workflow.input.connection_timeout}",
                      "read_timeout": "${workflow.input.read_timeout}"
                    },
                    "subWorkflowParam": {
                      "name": "rule_workflow",
                      "version": 1
                    },                
                    "type": "SUB_WORKFLOW"
                  }                   
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_2",
                "taskReferenceName": "companies_chunk_2_ref",
                "inputParameters": {
                "companies": "${companies_task_ref.output.response.body.content}",
                "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 2:${page_divide_size_ref.output.result} * 3]"
              },
              "type": "JSON_JQ_TRANSFORM"
              },
            {
              "name": "companies_chunk_2_size",
              "taskReferenceName": "companies_chunk_2_size_ref",
              "inputParameters": {
                "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                "evaluatorType": "javascript",
                "s": "${companies_chunk_2_ref.output.result}"
              },
              "type": "INLINE"
            },              
              {
                "name": "switch_companies_chunk_2",
                "taskReferenceName": "switch_companies_chunk_2_ref",
                "inputParameters": {
                  "size": "${companies_chunk_2_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                  {
                    "name": "start_rule_workflow_chunck_2",
                    "taskReferenceName": "start_rule_workflow_chunck_2_ref",
                    "inputParameters": {
                      "companies": "${companies_chunk_2_ref.output.result}",
                      "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                      "crawler_save_object": "${workflow.input.crawler_save_object}",
                      "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                      "save_method": "PUT",
                      "rule_name": "${workflow.input.rule_name}",
                      "execute_child": "${workflow.input.execute_child}",
                      "connection_timeout": "${workflow.input.connection_timeout}",
                      "read_timeout": "${workflow.input.read_timeout}"
                    },
                    "subWorkflowParam": {
                      "name": "rule_workflow",
                      "version": 1
                    },                
                    "type": "SUB_WORKFLOW"
                  }                   
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_3",
                "taskReferenceName": "companies_chunk_3_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 3:${page_divide_size_ref.output.result} * 4]"
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_3_size",
                "taskReferenceName": "companies_chunk_3_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_3_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_3",
                "taskReferenceName": "switch_companies_chunk_3_ref",
                "inputParameters": {
                  "size": "${companies_chunk_3_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_3",
                      "taskReferenceName": "start_rule_workflow_chunck_3_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_3_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                      "connection_timeout": "${workflow.input.connection_timeout}",
                      "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_4",
                "taskReferenceName": "companies_chunk_4_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 4:${page_divide_size_ref.output.result} * 5]"
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_4_size",
                "taskReferenceName": "companies_chunk_4_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_4_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_4",
                "taskReferenceName": "switch_companies_chunk_4_ref",
                "inputParameters": {
                  "size": "${companies_chunk_4_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_4",
                      "taskReferenceName": "start_rule_workflow_chunck_4_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_4_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                      "connection_timeout": "${workflow.input.connection_timeout}",
                      "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_5",
                "taskReferenceName": "companies_chunk_5_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 5:${page_divide_size_ref.output.result} * 6]"
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_5_size",
                "taskReferenceName": "companies_chunk_5_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_5_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_5",
                "taskReferenceName": "switch_companies_chunk_5_ref",
                "inputParameters": {
                  "size": "${companies_chunk_5_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_5",
                      "taskReferenceName": "start_rule_workflow_chunck_5_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_5_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                      "connection_timeout": "${workflow.input.connection_timeout}",
                      "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_6",
                "taskReferenceName": "companies_chunk_6_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 6:${page_divide_size_ref.output.result} * 7]"
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_6_size",
                "taskReferenceName": "companies_chunk_6_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_6_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_6",
                "taskReferenceName": "switch_companies_chunk_6_ref",
                "inputParameters": {
                  "size": "${companies_chunk_6_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_6",
                      "taskReferenceName": "start_rule_workflow_chunck_6_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_6_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                      "connection_timeout": "${workflow.input.connection_timeout}",
                      "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_7",
                "taskReferenceName": "companies_chunk_7_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 7:${page_divide_size_ref.output.result} * 8]"
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_7_size",
                "taskReferenceName": "companies_chunk_7_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_7_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_7",
                "taskReferenceName": "switch_companies_chunk_7_ref",
                "inputParameters": {
                  "size": "${companies_chunk_7_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_7",
                      "taskReferenceName": "start_rule_workflow_chunck_7_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_7_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                      "connection_timeout": "${workflow.input.connection_timeout}",
                      "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_8",
                "taskReferenceName": "companies_chunk_8_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 8:${page_divide_size_ref.output.result} * 9]"
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_8_size",
                "taskReferenceName": "companies_chunk_8_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_8_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_8",
                "taskReferenceName": "switch_companies_chunk_8_ref",
                "inputParameters": {
                  "size": "${companies_chunk_8_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_8",
                      "taskReferenceName": "start_rule_workflow_chunck_8_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_8_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_9",
                "taskReferenceName": "companies_chunk_9_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 9:${page_divide_size_ref.output.result} * 10]"
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_9_size",
                "taskReferenceName": "companies_chunk_9_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_9_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_9",
                "taskReferenceName": "switch_companies_chunk_9_ref",
                "inputParameters": {
                  "size": "${companies_chunk_9_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_9",
                      "taskReferenceName": "start_rule_workflow_chunck_9_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_9_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_10",
                "taskReferenceName": "companies_chunk_10_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 10:${page_divide_size_ref.output.result} * 11]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_10_size",
                "taskReferenceName": "companies_chunk_10_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_10_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_10",
                "taskReferenceName": "switch_companies_chunk_10_ref",
                "inputParameters": {
                  "size": "${companies_chunk_10_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_10",
                      "taskReferenceName": "start_rule_workflow_chunck_10_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_10_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_11",
                "taskReferenceName": "companies_chunk_11_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 11:${page_divide_size_ref.output.result} * 12]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_11_size",
                "taskReferenceName": "companies_chunk_11_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_11_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_11",
                "taskReferenceName": "switch_companies_chunk_11_ref",
                "inputParameters": {
                  "size": "${companies_chunk_11_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_11",
                      "taskReferenceName": "start_rule_workflow_chunck_11_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_11_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_12",
                "taskReferenceName": "companies_chunk_12_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 12:${page_divide_size_ref.output.result} * 13]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_12_size",
                "taskReferenceName": "companies_chunk_12_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_12_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_12",
                "taskReferenceName": "switch_companies_chunk_12_ref",
                "inputParameters": {
                  "size": "${companies_chunk_12_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_12",
                      "taskReferenceName": "start_rule_workflow_chunck_12_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_12_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_13",
                "taskReferenceName": "companies_chunk_13_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 13:${page_divide_size_ref.output.result} * 14]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_13_size",
                "taskReferenceName": "companies_chunk_13_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_13_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_13",
                "taskReferenceName": "switch_companies_chunk_13_ref",
                "inputParameters": {
                  "size": "${companies_chunk_13_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_13",
                      "taskReferenceName": "start_rule_workflow_chunck_13_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_13_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_14",
                "taskReferenceName": "companies_chunk_14_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 14:${page_divide_size_ref.output.result} * 15]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_14_size",
                "taskReferenceName": "companies_chunk_14_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_14_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_14",
                "taskReferenceName": "switch_companies_chunk_14_ref",
                "inputParameters": {
                  "size": "${companies_chunk_14_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_14",
                      "taskReferenceName": "start_rule_workflow_chunck_14_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_14_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_15",
                "taskReferenceName": "companies_chunk_15_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 15:${page_divide_size_ref.output.result} * 16]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_15_size",
                "taskReferenceName": "companies_chunk_15_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_15_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_15",
                "taskReferenceName": "switch_companies_chunk_15_ref",
                "inputParameters": {
                  "size": "${companies_chunk_15_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_15",
                      "taskReferenceName": "start_rule_workflow_chunck_15_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_15_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_16",
                "taskReferenceName": "companies_chunk_16_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 16:${page_divide_size_ref.output.result} * 17]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_16_size",
                "taskReferenceName": "companies_chunk_16_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_16_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_16",
                "taskReferenceName": "switch_companies_chunk_16_ref",
                "inputParameters": {
                  "size": "${companies_chunk_16_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_16",
                      "taskReferenceName": "start_rule_workflow_chunck_16_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_16_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_17",
                "taskReferenceName": "companies_chunk_17_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 17:${page_divide_size_ref.output.result} * 18]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_17_size",
                "taskReferenceName": "companies_chunk_17_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_17_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_17",
                "taskReferenceName": "switch_companies_chunk_17_ref",
                "inputParameters": {
                  "size": "${companies_chunk_17_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_17",
                      "taskReferenceName": "start_rule_workflow_chunck_17_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_17_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_18",
                "taskReferenceName": "companies_chunk_18_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 18:${page_divide_size_ref.output.result} * 19]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_18_size",
                "taskReferenceName": "companies_chunk_18_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_18_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_18",
                "taskReferenceName": "switch_companies_chunk_18_ref",
                "inputParameters": {
                  "size": "${companies_chunk_18_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_18",
                      "taskReferenceName": "start_rule_workflow_chunck_18_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_18_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ],
            [
              {
                "name": "companies_chunk_19",
                "taskReferenceName": "companies_chunk_19_ref",
                "inputParameters": {
                 "companies": "${companies_task_ref.output.response.body.content}",
                 "queryExpression": ".companies |.[${page_divide_size_ref.output.result} * 19:${workflow.input.page_size}]"                 
                },
                "type": "JSON_JQ_TRANSFORM"
              },
              {
                "name": "companies_chunk_19_size",
                "taskReferenceName": "companies_chunk_19_size_ref",
                "inputParameters": {
                  "expression": "(function(){ if ($.s.length > 0){return true;} else { return false;} })();",
                  "evaluatorType": "javascript",
                  "s": "${companies_chunk_19_ref.output.result}"
                },
                "type": "INLINE"
              },
              {
                "name": "switch_companies_chunk_19",
                "taskReferenceName": "switch_companies_chunk_19_ref",
                "inputParameters": {
                  "size": "${companies_chunk_19_size_ref.output.result}"
                },
                "type": "SWITCH",
                "decisionCases": {
                  "true": [
                    {
                      "name": "start_rule_workflow_chunck_19",
                      "taskReferenceName": "start_rule_workflow_chunck_19_ref",
                      "inputParameters": {
                        "companies": "${companies_chunk_19_ref.output.result}",
                        "parent_workflow_id": "${parent_workflow_id_ref.output.result}",
                        "crawler_save_object": "${workflow.input.crawler_save_object}",
                        "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                        "save_method": "PUT",
                        "rule_name": "${workflow.input.rule_name}",
                        "execute_child": "${workflow.input.execute_child}",
                        "connection_timeout": "${workflow.input.connection_timeout}",
                        "read_timeout": "${workflow.input.read_timeout}"
                      },
                      "subWorkflowParam": {
                        "name": "rule_workflow",
                        "version": 1
                      },                
                      "type": "SUB_WORKFLOW"
                    }
                  ]
                },
                "defaultCase": [],
                "evaluatorType": "value-param",
                "expression": "size"
              }
            ]
          ]
        },
        {
          "name": "join",
          "taskReferenceName": "join_ref",
          "inputParameters": {},
          "type": "JOIN",
          "decisionCases": {},
          "defaultCase": [],
          "forkTasks": [],
          "startDelay": 0,
          "joinOn": [],
          "optional": false,
          "defaultExclusiveJoinTask": [],
          "asyncComplete": false,
          "loopOver": [],
          "onStateChange": {}
        },
        {
          "name": "Set Last Page",
          "taskReferenceName": "set_last_page_ref",
          "inputParameters": {
            "last_page": "${companies_task_ref.output.response.body.last}"
          },
          "type": "SET_VARIABLE"
        }        
      ],
      "evaluatorType": "value-param",
      "onStateChange": {}
    },
    {
      "name": "start_crawler_407",
      "taskReferenceName": "start_crawler_407_ref",
      "inputParameters": {
        "status": "400",
        "workflowId": "${parent_workflow_id_ref.output.result}",
        "crawler_save_object": "true",
        "crawler_save_screenshot": "true",
        "rule_name": "${workflow.input.rule_name}",
        "execute_child": "${workflow.input.execute_child}",
        "connection_timeout": "${workflow.input.connection_timeout_max}",
        "read_timeout": "${workflow.input.read_timeout_max}"
      },
      "subWorkflowParam": {
        "name": "crawler_result_failed",
        "version": 1
      },                
      "type": "SUB_WORKFLOW"
    },
    {
      "name": "start_crawler_400",
      "taskReferenceName": "start_crawler_400_ref",
      "inputParameters": {
        "status": "407",
        "workflowId": "${parent_workflow_id_ref.output.result}",
        "crawler_save_object": "true",
        "crawler_save_screenshot": "true",
        "rule_name": "${workflow.input.rule_name}",
        "execute_child": "${workflow.input.execute_child}",
        "connection_timeout": "${workflow.input.connection_timeout_max}",
        "read_timeout": "${workflow.input.read_timeout_max}"
      },
      "subWorkflowParam": {
        "name": "crawler_result_failed",
        "version": 1
      },                
      "type": "SUB_WORKFLOW"
    }
  ],
  "inputParameters": [
    "page_size",
    "parent_workflow_id",
    "codice_categoria",
    "codice_ipa",
    "crawler_save_object",
    "crawler_save_screenshot",
    "rule_name",
    "execute_child",
    "id_ipa_from",
    "connection_timeout",
    "read_timeout",
    "connection_timeout_max",
    "read_timeout_max"
  ],
  "outputParameters": {},
  "schemaVersion": 2,
  "restartable": true,
  "workflowStatusListenerEnabled": false,
  "ownerEmail": "marco.spasiano@gmail.com",
  "timeoutPolicy": "ALERT_ONLY",
  "timeoutSeconds": 36000,
  "variables": {},
  "inputTemplate": {}
}