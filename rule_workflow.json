{
  "createTime": 1706115292688,
  "updateTime": 1706474406146,
  "accessPolicy": {},
  "name": "Rule_Workflow",
  "description": "Rule Workflow",
  "version": 1,
  "tasks": [
    {
      "name": "Execute Rule",
      "taskReferenceName": "execute_rule_ref",
      "inputParameters": {
        "companies_count": "${workflow.input.companies.length()}"
      },
      "type": "DO_WHILE",
      "startDelay": 0,
      "optional": true,
      "asyncComplete": false,
      "loopCondition": "if ($.execute_rule_ref['iteration'] < $.companies_count ) { true; } else { false; }",
      "loopOver": [
        {
          "name": "IPA Task",
          "taskReferenceName": "ipa_ref",
          "inputParameters": {
            "companies": "${workflow.input.companies}",
            "queryExpression": ".companies |.[(${execute_rule_ref.output.iteration} - 1)]"
          },
          "type": "JSON_JQ_TRANSFORM"
        },
        {
          "name": "switch_save_method",
          "taskReferenceName": "switch_save_method_ref",
          "inputParameters": {
            "method": "${workflow.input.save_method}"
          },
          "defaultCase": [],
          "evaluatorType": "value-param",
          "expression": "method",          
          "type": "SWITCH",
          "decisionCases": {
            "POST": [
              {
                  "name": "Result Trasform",
                  "taskReferenceName": "result_trasform_ref",
                  "inputParameters": {
                      "idResult": "${ipa_ref.output.result.id}",
                      "idIpa": "${ipa_ref.output.result.company.idIpa}",
                      "codiceIpa": "${ipa_ref.output.result.company.codiceIpa}",
                      "denominazioneEnte": "${ipa_ref.output.result.company.denominazioneEnte}",
                      "codiceFiscaleEnte": "${ipa_ref.output.result.company.codiceFiscaleEnte}",
                      "tipologia": "${ipa_ref.output.result.company.tipologia}",
                      "codiceCategoria": "${ipa_ref.output.result.company.codiceCategoria}",
                      "codiceNatura": "${ipa_ref.output.result.company.codiceNatura}",
                      "acronimo": "${ipa_ref.output.result.company.acronimo}",
                      "sitoIstituzionale": "${ipa_ref.output.result.company.sitoIstituzionale}",
                      "sorgente": "${ipa_ref.output.result.company.sorgente}",
                      "queryExpression": "{idResult: .idResult, id: .idIpa, codiceIpa: .codiceIpa, denominazioneEnte: .denominazioneEnte, codiceFiscaleEnte: .codiceFiscaleEnte, tipologia: .tipologia, codiceCategoria: .codiceCategoria, codiceNatura: .codiceNatura, acronimo: .acronimo, sitoIstituzionale: .sitoIstituzionale, sorgente: .sorgente}"
                  },
                  "type": "JSON_JQ_TRANSFORM"
              },              
              {
                "name": "Start Result Rule Detail Workflow",
                "taskReferenceName": "start_result_rule_detail_workflow_ref",
                "inputParameters": {
                  "ipa": "${result_trasform_ref.output.result}",
                  "parent_workflow_id": "${workflow.input.parent_workflow_id}",
                  "crawler_save_object": "${workflow.input.crawler_save_object}",
                  "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                  "save_method": "${workflow.input.save_method}"
                },
                "subWorkflowParam": {
                  "name": "Rule_Detail_Workflow",
                  "version": 1
                },                
                "type": "SUB_WORKFLOW"
              }
            ],
            "PUT": [
              {
                "name": "Start Rule Detail Workflow",
                "taskReferenceName": "start_rule_detail_workflow_ref",
                "inputParameters": {
                  "ipa": "${ipa_ref.output.result}",
                  "parent_workflow_id": "${workflow.input.parent_workflow_id}",
                  "crawler_save_object": "${workflow.input.crawler_save_object}",
                  "crawler_save_screenshot": "${workflow.input.crawler_save_screenshot}",
                  "save_method": "${workflow.input.save_method}"
                },
                "subWorkflowParam": {
                  "name": "Rule_Detail_Workflow",
                  "version": 1
                },                
                "type": "SUB_WORKFLOW"
              }
            ]
          }
        }
      ]
    }
  ],
  "inputParameters": [
    "companies",
    "crawler_save_object",
    "crawler_save_screenshot",
    "parent_workflow_id",
    "save_method"
  ],
  "outputParameters": {},
  "schemaVersion": 2,
  "restartable": true,
  "workflowStatusListenerEnabled": false,
  "ownerEmail": "marco.spasiano@gmail.com",
  "timeoutPolicy": "ALERT_ONLY",
  "timeoutSeconds": 0,
  "variables": {},
  "inputTemplate": {}
}